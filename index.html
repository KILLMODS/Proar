<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Proar - –ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä</title>
<!-- –ò–∫–æ–Ω–∫–∏ Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
<style>
body {
  margin: 0;
  font-family: 'Arial', sans-serif;
  display: flex;
  flex-direction: column;
  height: 100vh;
  background: var(--bg-color, #f0f0f0);
  transition: background 0.3s;
}
body.light-theme {
  --bg-color: #f0f0f0;
  --text-color: #000;
  --bg-chat: #fff;
  --text-chat: #000;
  --header-bg: #1976d2;
  --sidebar-bg: #fff;
  --message-sent: #dcf8c6;
  --message-recv: #fff;
}
body.dark-theme {
  --bg-color: #121212;
  --text-color: #fff;
  --bg-chat: #2c2c2c;
  --text-chat: #fff;
  --header-bg: #333;
  --sidebar-bg: #222;
  --message-sent: #4e9b7d;
  --message-recv: #444;
}
.header {
  height: 60px;
  background: var(--header-bg);
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 20px;
  color: #fff;
  font-weight: bold;
  font-size: 20px;
  transition: background 0.3s;
}
.header .title {
  display: flex;
  align-items: center;
}
.header .title span {
  margin-right: 10px;
}
.header button {
  background: transparent;
  border: none;
  color: #fff;
  font-size: 20px;
  cursor: pointer;
  margin-left: 10px;
  outline: none;
}
.header button:hover {
  color: #ddd;
}
.content {
  display: flex;
  flex: 1;
  overflow: hidden;
}
.sidebar {
  width: 250px;
  background: var(--sidebar-bg);
  display: flex;
  flex-direction: column;
  transition: transform 0.3s ease;
  position: relative;
  z-index: 10;
}
.sidebar.hidden {
  transform: translateX(-100%);
}
.sidebar-header {
  padding: 10px 15px;
  border-bottom: 1px solid #ccc;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
#search-panel {
  padding: 10px;
  display: none;
}
#search-panel.active {
  display: block;
}
#chats {
  flex: 1;
  overflow-y: auto;
}
.list-item {
  padding: 10px 15px;
  display: flex;
  align-items: center;
  cursor: pointer;
  border-bottom: 1px solid #eee;
  transition: background 0.2s;
}
.list-item:hover {
  background: #f1f1f1;
}
.list-item.active {
  background: #e0f7fa;
}
.avatar {
  width:40px;
  height:40px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:bold;
  color:#fff;
  font-size:18px;
  margin-right:10px;
  background:#ccc;
  flex-shrink:0;
}
.main {
  flex: 1;
  display: flex;
  flex-direction: column;
  background: var(--bg-chat);
}
#chat-header {
  padding: 10px 15px;
  border-bottom: 1px solid #ccc;
  background: var(--bg-chat);
}
#chat-title {
  font-size: 18px;
  font-weight: bold;
}
#chat-status {
  font-size: 12px;
  color: #555;
}
#messages {
  flex: 1;
  padding: 10px;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
}
.message {
  max-width: 70%;
  margin-bottom: 10px;
  padding: 8px 12px;
  border-radius: 20px;
  position: relative;
  word-wrap: break-word;
  background: var(--message-recv);
  color: #000;
  transition: background 0.2s;
}
.message.sent {
  background: var(--message-sent);
  align-self: flex-end;
}
.message.recv {
  background: var(--message-recv);
  align-self: flex-start;
}
.message .time {
  font-size: 10px;
  color: #555;
  margin-top: 4px;
  display: flex;
  justify-content: space-between;
}
.message .read-status {
  font-size: 10px;
  margin-left: 5px;
  color: #555;
}
.message img {
  max-width: 200px;
  display: block;
  margin-top: 5px;
  border-radius: 8px;
}
#input-area {
  display: flex;
  padding: 10px;
  border-top: 1px solid #ccc;
  background: var(--bg-chat);
}
#message-input {
  flex: 1;
  padding: 10px 15px;
  border-radius: 20px;
  border: 1px solid #ccc;
}
#file-input {
  display: none;
}
#file-label {
  background: #1976d2;
  color: #fff;
  padding: 8px 12px;
  border-radius: 20px;
  cursor: pointer;
  margin-right: 10px;
  display: flex;
  align-items: center;
}
#send-btn {
  background: #2196f3;
  color: #fff;
  border: none;
  padding: 10px 20px;
  border-radius: 20px;
  cursor: pointer;
  margin-left: 10px;
}
/* –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è */
#auth-container {
  position: fixed;
  top:0; left:0; right:0; bottom:0;
  background: rgba(0,0,0,0.5);
  display:flex;
  justify-content:center;
  align-items:center;
  z-index: 9999;
}
#auth-form {
  background:#fff;
  padding:20px;
  border-radius:8px;
  width:300px;
  display:flex;
  flex-direction:column;
}
#auth-form input {
  margin-bottom:10px;
  padding:8px;
  border-radius:4px;
  border:1px solid #ccc;
}
#auth-form button {
  padding:8px;
  border:none;
  background:#1976d2;
  color:#fff;
  border-radius:4px;
  cursor:pointer;
  margin-top:5px;
}
/* –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º—ã */
#theme-toggle {
  background: transparent;
  border: none;
  color: #fff;
  font-size: 16px;
  cursor: pointer;
  margin-left:10px;
}
/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–æ—Ñ–∏–ª—è */
#profile-modal {
  position: fixed;
  top:0; left:0; right:0; bottom:0;
  background: rgba(0,0,0,0.5);
  display:flex;
  justify-content:center;
  align-items:center;
  z-index: 10000;
  display:none;
}
#profile-content {
  background:#fff;
  padding:20px;
  border-radius:8px;
  max-width:400px;
  width:90%;
  display:flex;
  flex-direction:column;
  align-items: center;
}
#profile-avatar {
  width:100px;
  height:100px;
  border-radius:50%;
  object-fit:cover;
  margin-bottom:10px;
}
#profile-close {
  align-self:flex-end;
  cursor:pointer;
  font-size:20px;
  margin-top:10px;
  color:#333;
}
</style>
</head>
<body class="light-theme">

<div class="header" style="background:var(--header-bg);">
  <div class="title"><span>Proar</span></div>
  <div>
    <button id="theme-toggle" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É"><i class="fas fa-moon"></i></button>
    <button onclick="toggleSidebar()" title="–ú–µ–Ω—é"><i class="fas fa-bars"></i></button>
  </div>
</div>

<div class="content">
  <div class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <h3>–ú–æ–∏ –∫–æ–Ω—Ç–∞–∫—Ç—ã</h3>
    </div>
    <div id="search-panel">
      <input type="text" id="search-input" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏..." oninput="searchUsers()" />
      <div id="search-results"></div>
    </div>
    <div id="chats"></div>
  </div>
  <div class="main" id="main">
    <div id="chat-header">
      <div class="chat-title" id="chat-title">–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç</div>
      <div id="chat-status"></div>
    </div>
    <div id="messages"></div>
    <div id="input-area">
      <label id="file-label" for="file-input"><i class="fas fa-paperclip"></i></label>
      <input type="file" id="file-input" />
      <input type="text" id="message-input" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ" />
      <button id="send-btn" onclick="sendMessage()"><i class="fas fa-paper-plane"></i></button>
    </div>
  </div>
</div>

<!-- –ü—Ä–æ—Ñ–∏–ª—å -->
<div id="profile-modal">
  <div id="profile-content">
    <div id="profile-close" onclick="closeProfile()">&times;</div>
    <img id="profile-avatar" src="" />
    <h3 id="profile-nickname"></h3>
    <p id="profile-info"></p>
  </div>
</div>

<!-- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è -->
<div id="auth-container">
  <div id="auth-form">
    <h3>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è / –í—Ö–æ–¥</h3>
    <input type="text" id="auth-nickname" placeholder="–í–∞—à –Ω–∏–∫" />
    <input type="text" id="auth-username" placeholder="–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è" />
    <input type="file" id="auth-avatar" accept="image/*" />
    <input type="email" id="auth-email" placeholder="Email" />
    <input type="password" id="auth-password" placeholder="–ü–∞—Ä–æ–ª—å" />
    <button onclick="register()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
    <button onclick="login()">–í–æ–π—Ç–∏</button>
  </div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyB-R3yavvxAaMeJ6bi_RneFuMkrqmHyE5g",
  authDomain: "proar-3cf77.firebaseapp.com",
  projectId: "proar-3cf77",
  storageBucket: "proar-3cf77.appspot.com",
  messagingSenderId: "676918837096",
  appId: "com.killmods.proar"
};
firebase.initializeApp(firebaseConfig);
const auth=firebase.auth();
const db=firebase.firestore();
const storage=firebase.storage();

let currentUser=null;
let currentChatId=null;
let chatsUnsub=null;
let chatMessagesUnsub=null;

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
auth.onAuthStateChanged(async user => {
  if (user) {
    currentUser=user;
    document.getElementById('auth-container').style.display='none';
    await loadUserProfile();
    loadChats();
    updateStatus('online');
  } else {
    document.getElementById('auth-container').style.display='flex';
    document.getElementById('chats').innerHTML='';
  }
});

// –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è
async function loadUserProfile() {
  const userDoc=await db.collection('users').doc(currentUser.uid).get();
  if (userDoc.exists) {
    // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
  }
}

// –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
async function register() {
  const email=document.getElementById('auth-email').value;
  const pass=document.getElementById('auth-password').value;
  const nickname=document.getElementById('auth-nickname').value;
  const username=document.getElementById('auth-username').value;
  const avatarFile=document.getElementById('auth-avatar').files[0];

  if (!email || !pass || !nickname || !username) {
    alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
    return;
  }
  try {
    const userCred=await auth.createUserWithEmailAndPassword(email,pass);
    let avatarUrl='';
    if (avatarFile) {
      const ref=storage.ref().child('avatars/'+userCred.user.uid+'/'+avatarFile.name);
      await ref.put(avatarFile);
      avatarUrl=await ref.getDownloadURL();
    }
    await db.collection('users').doc(userCred.user.uid).set({
      nickname:nickname,
      username:username,
      avatarUrl:avatarUrl,
      status:'online',
      lastSeen:firebase.firestore.FieldValue.serverTimestamp()
    });
    alert('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞');
  } catch(e) {
    alert('–û—à–∏–±–∫–∞: '+e.message);
  }
}

// –í–æ–π—Ç–∏
async function login() {
  const email=document.getElementById('auth-email').value;
  const pass=document.getElementById('auth-password').value;
  try {
    await auth.signInWithEmailAndPassword(email,pass);
  } catch(e) {
    alert('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: '+e.message);
  }
}

// –í—ã–π—Ç–∏
async function logout() {
  await auth.signOut();
  updateStatus('offline');
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
async function updateStatus(state) {
  if (currentUser) {
    await db.collection('users').doc(currentUser.uid).update({
      status: state,
      lastSeen:firebase.firestore.FieldValue.serverTimestamp()
    });
  }
}

// –ó–∞–≥—Ä—É–∑–∫–∞ —á–∞—Ç–æ–≤
async function loadChats() {
  if (chatsUnsub) chatsUnsub();
  const q = db.collection('chats').where('members','array-contains',currentUser.uid);
  chatsUnsub=q.onSnapshot(snap => {
    document.getElementById('chats').innerHTML='';
    snap.forEach(doc => {
      const chat=doc.data();
      const div=document.createElement('div');
      div.className='list-item';
      div.id='chat-'+doc.id;
      div.onclick=()=>openChat(doc.id);
      let avatarHtml='';
      if (chat.avatarUrl) {
        avatarHtml=`<img src="${chat.avatarUrl}" style="width:40px;height:40px;border-radius:50%;object-fit:cover;">`;
      } else {
        const initials=chat.name ? chat.name.charAt(0).toUpperCase() : '?';
        const bgColor='hsl('+Math.floor(Math.random()*360)+',70%,50%)';
        avatarHtml=`<div class="avatar" style="background:${bgColor};">${initials}</div>`;
      }
      div.innerHTML=`
        ${avatarHtml}
        <div style="flex:1;">
          <div style="font-weight:bold;">${chat.name || '–ß–∞—Ç'}</div>
          <div style="font-size:12px; color:#555;">–£—á–∞—Å—Ç–Ω–∏–∫–æ–≤: ${chat.members.length}</div>
        </div>`;
      document.getElementById('chats').appendChild(div);
    });
  });
}

// –û—Ç–∫—Ä—ã—Ç–∏–µ —á–∞—Ç–∞
async function openChat(id) {
  currentChatId=id;
  document.querySelectorAll('.list-item').forEach(el=>el.classList.remove('active'));
  document.getElementById('chat-'+id).classList.add('active');

  const chatRef=db.collection('chats').doc(id);
  const chatData=await chatRef.get();
  document.getElementById('chat-title').innerText='–ß–∞—Ç: '+(chatData.data().name || '');
  // –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
  if (window.chatMessagesUnsub) chatMessagesUnsub();
  chatMessagesUnsub=chatRef.collection('messages').orderBy('createdAt','asc').onSnapshot(snap => {
    const container=document.getElementById('messages');
    container.innerHTML='';
    snap.forEach(doc => {
      const msg=doc.data();
      const div=document.createElement('div');
      div.className='message '+(msg.senderId===currentUser.uid?'sent':'recv');
      // –í—Ä–µ–º—è
      const time=new Date(msg.createdAt?.seconds*1000 || Date.now());
      const timeStr=time.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
      const timeDiv=document.createElement('div');
      timeDiv.className='time';
      timeDiv.innerHTML=`
        <span>${timeStr}</span>
        <span class="read-status" id="status-${doc.id}">üì©</span>`;
      div.appendChild(timeDiv);
      // –¢–µ–∫—Å—Ç –∏–ª–∏ –∫–∞—Ä—Ç–∏–Ω–∫–∞
      if (msg.fileUrl) {
        const img=document.createElement('img');
        img.src=msg.fileUrl;
        div.appendChild(img);
      }
      if (msg.text) {
        div.innerHTML+=msg.text;
      }
      // –ö–ª–∏–∫ –ø–æ –∞–≤–∞—Ç–∞—Ä—É –∏–ª–∏ –Ω–∏–∫–Ω–µ–π–º—É
      div.onclick=function(e){
        if(e.target.closest('.message')){
          // –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º, –µ—Å–ª–∏ –∫–ª–∏–∫ –ø–æ —Å–æ–æ–±—â–µ–Ω–∏—é
        } else {
          showProfile(msg.senderId);
        }
      }
      container.appendChild(div);
      updateMessageStatus(doc.id, msg.senderId);
    });
    container.scrollTop=container.scrollHeight;
  });
  // –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ (–º–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å)
  const chatDoc=await chatRef.get();
  const chat=chatDoc.data();
  document.getElementById('chat-title').innerHTML+=`<div style="font-size:12px;">–£—á–∞—Å—Ç–Ω–∏–∫–æ–≤: ${chat.members.length}</div>`;
}

// –ü—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–æ—Ñ–∏–ª—è
async function showProfile(userId) {
  const userDoc=await db.collection('users').doc(userId).get();
  if(userDoc.exists){
    const data=userDoc.data();
    document.getElementById('profile-avatar').src=data.avatarUrl || '';
    document.getElementById('profile-nickname').innerText=data.nickname || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
    document.getElementById('profile-info').innerText=
      'Username: '+(data.username || '')+'\n'+
      'Status: '+(data.status || '')+'\n'+
      'Last seen: '+(data.lastSeen?.toDate().toLocaleString() || '');
    document.getElementById('profile-modal').style.display='flex';
  }
}
function closeProfile() {
  document.getElementById('profile-modal').style.display='none';
}

// –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
async function sendMessage() {
  const text=document.getElementById('message-input').value;
  const fileInput=document.getElementById('file-input');
  let fileUrl='';
  if (fileInput.files[0]) {
    const file=fileInput.files[0];
    const ref=storage.ref().child('files/'+Date.now()+'_'+file.name);
    await ref.put(file);
    fileUrl=await ref.getDownloadURL();
  }
  if (!currentChatId) { alert('–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç'); return; }
  await db.collection('chats').doc(currentChatId).collection('messages').add({
    text:text,
    fileUrl:fileUrl,
    senderId:currentUser.uid,
    createdAt:firebase.firestore.FieldValue.serverTimestamp()
  });
  document.getElementById('message-input').value='';
  document.getElementById('file-input').value='';
}

async function updateMessageStatus(msgId, senderId) {
  if (senderId===currentUser.uid) {
    const statusEl=document.getElementById(`status-${msgId}`);
    if (statusEl) {
      statusEl.innerText='‚úì‚úì'; // –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ
    }
  }
}

// –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
async function searchUsers() {
  const query=document.getElementById('search-input').value.trim().toLowerCase();
  if (!query) {
    document.getElementById('search-results').innerHTML='';
    return;
  }
  document.getElementById('search-results').innerHTML='–ó–∞–≥—Ä—É–∑–∫–∞...';

  const q= db.collection('users').where('username','>=',query).where('username','<=',query+'\uf8ff');
  const snap= await q.get();
  const resultsDiv=document.getElementById('search-results');
  resultsDiv.innerHTML='';
  if (snap.empty) {
    resultsDiv.innerHTML='–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω.';
    return;
  }
  snap.forEach(doc => {
    const userData=doc.data();
    const userId=doc.id;
    const div=document.createElement('div');
    div.style.padding='8px';
    div.style.borderBottom='1px solid #ccc';
    div.style.display='flex';
    div.style.alignItems='center';
    div.style.cursor='pointer';
    div.onmouseenter=()=>div.style.background='#f1f1f1';
    div.onmouseleave=()=>div.style.background='none';

    let avatarHtml='';
    if (userData.avatarUrl) {
      avatarHtml=`<img src="${userData.avatarUrl}" style="width:40px;height:40px;border-radius:50%;object-fit:cover;">`;
    } else {
      const initials=userData.nickname ? userData.nickname.charAt(0).toUpperCase() : '?';
      const bgColor='hsl('+Math.floor(Math.random()*360)+',70%,50%)';
      avatarHtml=`<div class="avatar" style="background:${bgColor};">${initials}</div>`;
    }

    let statusText='–î–∞–≤–Ω–æ';
    if (userData.status==='online') statusText='–û–Ω–ª–∞–π–Ω';
    else if (userData.lastSeen) {
      const last=new Date(userData.lastSeen.seconds*1000);
      const now=new Date();
      const diff=Math.floor((now - last)/1000);
      if (diff<300) statusText='–ù–µ–¥–∞–≤–Ω–æ';
      else if (diff<3600) statusText='–ú–µ–Ω–µ–µ —á–∞—Å–∞ –Ω–∞–∑–∞–¥';
      else if (diff<86400) statusText='–°–µ–≥–æ–¥–Ω—è';
    }

    div.innerHTML=`
      ${avatarHtml}
      <div style="flex:1;">
        <div style="font-weight:bold;">${userData.nickname || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'}</div>
        <div style="font-size:12px; color:#555;">${statusText}</div>
      </div>`;
    div.onclick=()=>addUserToChat(userId);
    resultsDiv.appendChild(div);
  });
}

// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Ç–µ–∫—É—â–∏–π —á–∞—Ç
async function addUserToChat(userId) {
  if (!currentChatId) {
    alert('–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç');
    return;
  }
  const chatRef=db.collection('chats').doc(currentChatId);
  await chatRef.update({
    members:firebase.firestore.FieldValue.arrayUnion(userId)
  });
  openChat(currentChatId);
}

// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏
function toggleSidebar() {
  document.getElementById('sidebar').classList.toggle('hidden');
}

// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–º—ã
const themeBtn=document.getElementById('theme-toggle');
document.getElementById('theme-toggle').onclick=()=>{
  document.body.classList.toggle('dark-theme');
  document.body.classList.toggle('light-theme');
  if (document.body.classList.contains('dark-theme')) {
    themeBtn.innerHTML='<i class="fas fa-sun"></i>';
  } else {
    themeBtn.innerHTML='<i class="fas fa-moon"></i>';
  }
}

// –û—Ç–∫—Ä—ã—Ç–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ –∫–ª–∏–∫—É
function showProfile(userId) {
  db.collection('users').doc(userId).get().then(doc=>{
    if(doc.exists){
      const data=doc.data();
      document.getElementById('profile-avatar').src=data.avatarUrl || '';
      document.getElementById('profile-nickname').innerText=data.nickname || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
      document.getElementById('profile-info').innerText=
        'Username: '+(data.username || '')+'\n'+
        'Status: '+(data.status || '')+'\n'+
        'Last seen: '+(data.lastSeen?.toDate().toLocaleString() || '');
      document.getElementById('profile-modal').style.display='flex';
    }
  });
}
function closeProfile() {
  document.getElementById('profile-modal').style.display='none';
}
</script>
</body>
</html>
<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Proar</title>
<link rel="stylesheet" href="styles.css" />
<!-- Иконки -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
</head>
<body>

<!-- Заголовок -->
<div class="header">
  <div class="title" style="position:relative; height:40px;">
    <span id="update-text" style="opacity:0;">Обновление...<span class="loader"></span></span>
    <span id="logo-text" style="opacity:1;">Proar</span>
    <span id="unread-count">0</span>
  </div>
  <div class="buttons">
    <button title="Меню" onclick="toggleSidebar()"><i class="fas fa-bars"></i></button>
    <button title="Профиль" onclick="showProfile()"><i class="fas fa-user"></i></button>
    <button title="Создать чат" onclick="openExtendedChatCreation()"><i class="fas fa-plus"></i></button>
    <button title="Тема" id="theme-toggle"><i class="fas fa-moon"></i></button>
    <button title="Выйти" onclick="logout()"><i class="fas fa-sign-out-alt"></i></button>
  </div>
</div>

<!-- Контейнер -->
<div class="container">
  <!-- Левая панель -->
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <h3>Мои чаты</h3>
    </div>
    <button id="new-chat-btn" onclick="openExtendedChatCreation()">Расширенное создание</button>
    <button id="search-username-btn" onclick="toggleSearchResults()">Поиск по username</button>
    <div id="search-panel">
      <input id="search-input" placeholder="Поиск..." oninput="searchEntities()"/>
    </div>
    <div id="chats"></div>
  </aside>

  <!-- Основной чат -->
  <section class="main" id="main">
    <div id="chat-header">
      <div style="display:flex; align-items:center;">
        <span id="chat-title">Выберите чат</span>
        <div id="chat-unread-badge" style="margin-left:8px; display:none; background:#1976d2; color:#fff; border-radius:10px; padding:2px 8px; font-size:12px; font-weight:600;">0</div>
      </div>
      <div style="display:flex; gap:8px;">
        <button onclick="archiveChat()" class="btn" style="font-size:12px;">Архив</button>
        <button onclick="showFullChat()" class="btn" style="font-size:12px;">Просмотр</button>
        <button onclick="showProfile()" class="btn" style="font-size:12px;"><i class="fas fa-cog"></i></button>
      </div>
    </div>
    <div id="messages" style="flex:1; padding:12px; overflow-y:auto; max-height: calc(100vh - 250px);"></div>
    <!-- Ввод сообщений -->
    <form id="input-area" onsubmit="event.preventDefault(); sendMessage()">
      <label id="file-label" title="Прикрепить файл"><i class="fas fa-paperclip"></i></label>
      <input type="file" id="file-input" style="display:none"/>
      <input id="message-input" placeholder="Введите сообщение"/>
      <button id="send-btn" type="submit"><i class="fas fa-paper-plane"></i></button>
      <button type="button" id="voice-btn" title="Записать голос" style="margin-left:auto; background:linear-gradient(135deg, #43e97b, #38f9d7); border:none; padding:8px 14px; border-radius:20px; cursor:pointer; transition:transform 0.2s;">
        <i class="fas fa-microphone"></i>
      </button>
    </form>
  </section>
</div>

<!-- Модальные окна -->
<!-- Профиль -->
<div id="profile-panel" class="modal">
  <h3>Профиль</h3>
  <input id="profile-img" placeholder="Аватар URL" />
  <input id="profile-name" placeholder="Имя" />
  <input id="profile-username" placeholder="Username" />
  <input id="profile-status" placeholder="Статус" />
  <div class="modal-actions">
    <button class="btn" onclick="saveProfile()">Сохранить</button>
    <button class="btn-secondary" onclick="closeProfile()">Отмена</button>
  </div>
</div>

<!-- Расширенное создание чата -->
<div id="extended-chat-creation" class="modal">
  <div class="modal-content">
    <h3>Расширенное создание</h3>
    <input placeholder="Название" id="ext-chat-name"/>
    <input placeholder="Участники (через запятую)" id="ext-chat-members"/>
    <div class="modal-actions">
      <button class="btn" onclick="createExtendedChat()">Создать</button>
      <button class="btn-secondary" onclick="closeExtendedChat()">Отмена</button>
    </div>
  </div>
</div>

<!-- Создать группу -->
<div id="group-create-modal" class="modal">
  <div class="modal-content">
    <h3>Создать группу</h3>
    <input placeholder="Имя" id="group-name"/>
    <select id="group-privacy">
      <option value="public">Публичная</option>
      <option value="private">Приватная</option>
    </select>
    <input placeholder="Ссылка или username" id="group-link"/>
    <input placeholder="Username группы" id="group-username"/>
    <textarea placeholder="Описание" id="group-desc"></textarea>
    <input type="file" id="group-avatar"/>
    <div class="modal-actions">
      <button class="btn" onclick="createGroup()">Создать</button>
      <button class="btn-secondary" onclick="closeGroupCreate()">Отмена</button>
    </div>
  </div>
</div>

<!-- Контекстное меню -->
<div id="context-menu"></div>

<!-- Полноэкранный чат -->
<div id="full-chat-panel" class="modal">
  <div class="full-chat-header">
    <div id="full-chat-title">Чат</div>
    <button id="close-full-chat" onclick="closeFullChat()">Закрыть</button>
  </div>
  <div id="full-chat-messages"></div>
  <form id="full-chat-input" onsubmit="event.preventDefault(); sendFullMessage()">
    <input id="full-chat-message" placeholder="Сообщение"/>
    <button id="full-chat-send" type="submit"><i class="fas fa-paper-plane"></i></button>
  </form>
</div>

<!-- Жалобы -->
<div id="report-form" class="modal">
  <h4>Пожаловаться на сообщение</h4>
  <div>
    <label>Что нарушает:</label>
    <select id="report-reason">
      <option value="spam">Спам</option>
      <option value="harassment">Оскорбление/Травля</option>
      <option value="inappropriate">Неподобающий контент</option>
      <option value="other">Другое</option>
    </select>
  </div>
  <div>
    <label>Описание:</label>
    <textarea id="report-description" style="width:100%; height:80px;"></textarea>
  </div>
  <div class="modal-actions">
    <button class="btn" onclick="submitReport()">Отправить</button>
    <button class="btn-secondary" onclick="closeReport()">Отмена</button>
  </div>
</div>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<script src="firebase-config.js"></script>
<script src="script.js"></script>
</body>
</html>